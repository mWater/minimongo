require=function t(e,n,r){function o(u,c){if(!n[u]){if(!e[u]){var s="function"==typeof require&&require;if(!c&&s)return s(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var a=n[u]={exports:{}};e[u][0].call(a.exports,function(t){var n=e[u][1][t];return o(n?n:t)},a,a.exports,t,e,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({"Focm2+":[function(t,e,n){n.MemoryDb=t("./lib/MemoryDb"),n.LocalStorageDb=t("./lib/LocalStorageDb"),n.IndexedDb=t("./lib/IndexedDb"),n.WebSQLDb=t("./lib/WebSQLDb"),n.RemoteDb=t("./lib/RemoteDb"),n.HybridDb=t("./lib/HybridDb"),n.ReplicatingDb=t("./lib/ReplicatingDb"),n.utils=t("./lib/utils")},{"./lib/HybridDb":6,"./lib/IndexedDb":7,"./lib/LocalStorageDb":8,"./lib/MemoryDb":9,"./lib/RemoteDb":10,"./lib/ReplicatingDb":11,"./lib/WebSQLDb":12,"./lib/utils":15}],minimongo:[function(t,e){e.exports=t("Focm2+")},{}],jquery:[function(t,e){e.exports=t("/nayFu")},{}],"/nayFu":[function(t,e){e.exports=window.$},{}],5:[function(t,e){var n=t("lodash");EJSON={};var r={};EJSON.addType=function(t,e){if(n.has(r,t))throw new Error("Type "+t+" already present");r[t]=e};var o=[{matchJSONValue:function(t){return n.has(t,"$date")&&1===n.size(t)},matchObject:function(t){return t instanceof Date},toJSONValue:function(t){return{$date:t.getTime()}},fromJSONValue:function(t){return new Date(t.$date)}},{matchJSONValue:function(t){return n.has(t,"$binary")&&1===n.size(t)},matchObject:function(t){return"undefined"!=typeof Uint8Array&&t instanceof Uint8Array||t&&n.has(t,"$Uint8ArrayPolyfill")},toJSONValue:function(t){return{$binary:EJSON._base64Encode(t)}},fromJSONValue:function(t){return EJSON._base64Decode(t.$binary)}},{matchJSONValue:function(t){return n.has(t,"$escape")&&1===n.size(t)},matchObject:function(t){return n.isEmpty(t)||n.size(t)>2?!1:n.any(o,function(e){return e.matchJSONValue(t)})},toJSONValue:function(t){var e={};return n.each(t,function(t,n){e[n]=EJSON.toJSONValue(t)}),{$escape:e}},fromJSONValue:function(t){var e={};return n.each(t.$escape,function(t,n){e[n]=EJSON.fromJSONValue(t)}),e}},{matchJSONValue:function(t){return n.has(t,"$type")&&n.has(t,"$value")&&2===n.size(t)},matchObject:function(t){return EJSON._isCustomType(t)},toJSONValue:function(t){return{$type:t.typeName(),$value:t.toJSONValue()}},fromJSONValue:function(t){var e=t.$type,n=r[e];return n(t.$value)}}];EJSON._isCustomType=function(t){return t&&"function"==typeof t.toJSONValue&&"function"==typeof t.typeName&&n.has(r,t.typeName())};var i=EJSON._adjustTypesToJSONValue=function(t){if(null===t)return null;var e=u(t);return void 0!==e?e:(n.each(t,function(e,n){if("object"==typeof e||void 0===e){var r=u(e);return r?(t[n]=r,void 0):(i(e),void 0)}}),t)},u=function(t){for(var e=0;e<o.length;e++){var n=o[e];if(n.matchObject(t))return n.toJSONValue(t)}return void 0};EJSON.toJSONValue=function(t){var e=u(t);return void 0!==e?e:("object"==typeof t&&(t=EJSON.clone(t),i(t)),t)};var c=EJSON._adjustTypesFromJSONValue=function(t){if(null===t)return null;var e=s(t);return e!==t?e:(n.each(t,function(e,n){if("object"==typeof e){var r=s(e);if(e!==r)return t[n]=r,void 0;c(e)}}),t)},s=function(t){if("object"==typeof t&&null!==t&&n.size(t)<=2&&n.all(t,function(t,e){return"string"==typeof e&&"$"===e.substr(0,1)}))for(var e=0;e<o.length;e++){var r=o[e];if(r.matchJSONValue(t))return r.fromJSONValue(t)}return t};EJSON.fromJSONValue=function(t){var e=s(t);return e===t&&"object"==typeof t?(t=EJSON.clone(t),c(t),t):e},EJSON.stringify=function(t){return JSON.stringify(EJSON.toJSONValue(t))},EJSON.parse=function(t){return EJSON.fromJSONValue(JSON.parse(t))},EJSON.isBinary=function(t){return"undefined"!=typeof Uint8Array&&t instanceof Uint8Array||t&&t.$Uint8ArrayPolyfill},EJSON.equals=function(t,e,r){var o,i=!(!r||!r.keyOrderSensitive);if(t===e)return!0;if(!t||!e)return!1;if("object"!=typeof t||"object"!=typeof e)return!1;if(t instanceof Date&&e instanceof Date)return t.valueOf()===e.valueOf();if(EJSON.isBinary(t)&&EJSON.isBinary(e)){if(t.length!==e.length)return!1;for(o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0}if("function"==typeof t.equals)return t.equals(e,r);if(t instanceof Array){if(!(e instanceof Array))return!1;if(t.length!==e.length)return!1;for(o=0;o<t.length;o++)if(!EJSON.equals(t[o],e[o],r))return!1;return!0}var u;if(i){var c=[];return n.each(e,function(t,e){c.push(e)}),o=0,u=n.all(t,function(t,n){return o>=c.length?!1:n!==c[o]?!1:EJSON.equals(t,e[c[o]],r)?(o++,!0):!1}),u&&o===c.length}return o=0,u=n.all(t,function(t,i){return n.has(e,i)?EJSON.equals(t,e[i],r)?(o++,!0):!1:!1}),u&&n.size(e)===o},EJSON.clone=function(t){var e;if("object"!=typeof t)return t;if(null===t)return null;if(t instanceof Date)return new Date(t.getTime());if(EJSON.isBinary(t)){e=EJSON.newBinary(t.length);for(var r=0;r<t.length;r++)e[r]=t[r];return e}if(n.isArray(t)||n.isArguments(t)){for(e=[],r=0;r<t.length;r++)e[r]=EJSON.clone(t[r]);return e}return"function"==typeof t.clone?t.clone():(e={},n.each(t,function(t,n){e[n]=EJSON.clone(t)}),e)},e.exports=EJSON},{lodash:"nJZoxB"}],6:[function(t,e){var n,r,o,i,u;u=t("lodash"),o=t("./utils").processFind,i=t("./utils"),e.exports=r=function(){function t(t,e){this.localDb=t,this.remoteDb=e,this.collections={}}return t.prototype.addCollection=function(t,e,r,o){var i,c;return u.isFunction(e)&&(c=[{},e,r],e=c[0],r=c[1],o=c[2]),i=new n(t,this.localDb[t],this.remoteDb[t],e),this[t]=i,this.collections[t]=i,null!=r?r():void 0},t.prototype.removeCollection=function(t,e){return delete this[t],delete this.collections[t],null!=e?e():void 0},t.prototype.upload=function(t,e){var n,r;return n=u.values(this.collections),r=function(t,e,n){var o;return o=u.first(t),o?o.upload(function(){return r(u.rest(t),e,n)},function(t){return n(t)}):e()},r(n,t,e)},t}(),n=function(){function t(t,e,n,r){this.name=t,this.localCol=e,this.remoteCol=n,this.options=r||{},u.defaults(this.options,{cacheFind:!0,cacheFindOne:!0,interim:!0,useLocalOnRemoteError:!0,shortcut:!1,timeout:0,sortUpserts:null})}return t.prototype.find=function(t,e){return null==e&&(e={}),{fetch:function(n){return function(r,o){return n._findFetch(t,e,r,o)}}(this)}},t.prototype.findOne=function(t,e,n,r){var o,i;return null==e&&(e={}),u.isFunction(e)&&(i=[{},e,n],e=i[0],n=i[1],r=i[2]),u.defaults(e,this.options),o=function(o){return function(i){var c;return c=u.cloneDeep(e),c.interim=!1,c.cacheFind=e.cacheFindOne,t._id?c.limit=1:delete c.limit,o.find(t,c).fetch(function(t){return t.length>0?u.isEqual(i,t[0])?void 0:n(t[0]):n(null)},r)}}(this),e.interim||e.shortcut?this.localCol.findOne(t,e,function(t){return t&&(n(u.cloneDeep(t)),e.shortcut)?void 0:o(t)},r):o()},t.prototype._findFetch=function(t,e,n,r){var i,c;return u.defaults(e,this.options),c=function(i){return function(c){var s,a,l,f,d;return a=u.cloneDeep(e),e.cacheFind&&delete a.fields,d=null,f=!1,l=function(s){var a,l;return d&&clearTimeout(d),f?(e.cacheFind&&i.localCol.cache(s,t,e,function(){},r),void 0):e.cacheFind?(a=function(){var o;return o=function(t){return u.isEqual(c,t)?void 0:n(t)},i.localCol.find(t,e).fetch(o,r)},i.localCol.cache(s,t,e,a,r)):(l=s,i.localCol.pendingRemoves(function(a){var f;return a.length>0&&(f=u.object(u.map(a,function(t){return[t,t]})),l=u.filter(s,function(t){return!u.has(f,t._id)})),i.localCol.pendingUpserts(function(r){var i;return r.length>0&&(i=u.object(u.map(r,function(t){return t.doc._id}),u.map(r,function(t){return t.doc._id})),l=u.filter(l,function(t){return!u.has(i,t._id)}),l=l.concat(u.pluck(r,"doc")),l=o(l,t,e)),u.isEqual(c,l)?void 0:n(l)},r)},r))},s=function(o){if(d&&clearTimeout(d),!f&&!e.interim){if(e.useLocalOnRemoteError)return i.localCol.find(t,e).fetch(n,r);if(r)return r(o)}},e.timeout&&(d=setTimeout(function(){if(d=null,f=!0,!e.interim){if(e.useLocalOnRemoteError)return i.localCol.find(t,e).fetch(n,r);if(r)return r(new Error("Remote timed out"))}},e.timeout)),i.remoteCol.find(t,a).fetch(l,s)}}(this),e.interim?(i=function(t){return n(t),c(t)},this.localCol.find(t,e).fetch(i,r)):c()},t.prototype.upsert=function(t,e,n,r){return this.localCol.upsert(t,e,function(){return u.isFunction(e)&&(n=e),"function"==typeof n?n(t):void 0},r)},t.prototype.remove=function(t,e,n){return this.localCol.remove(t,function(){return null!=e?e():void 0},n)},t.prototype.upload=function(t,e){var n,r;return r=function(t){return function(e,n,o){var i;return i=u.first(e),i?t.remoteCol.upsert(i.doc,i.base,function(c){return t.localCol.resolveUpserts([i],function(){return c?t.localCol.cacheOne(c,function(){return r(u.rest(e),n,o)},o):t.localCol.remove(i.doc._id,function(){return t.localCol.resolveRemove(i.doc._id,function(){return r(u.rest(e),n,o)},o)},o)},o)},function(c){return 410===c.status||403===c.status?t.localCol.remove(i.doc._id,function(){return t.localCol.resolveRemove(i.doc._id,function(){return 410===c.status?r(u.rest(e),n,o):o(c)},o)},o):o(c)}):n()}}(this),n=function(t){return function(e,r,o){var i;return i=u.first(e),i?t.remoteCol.remove(i,function(){return t.localCol.resolveRemove(i,function(){return n(u.rest(e),r,o)},o)},function(c){return 410===c.status||403===c.status?t.localCol.resolveRemove(i,function(){return 410===c.status?n(u.rest(e),r,o):o(c)},o):o(c)},o):r()}}(this),this.localCol.pendingUpserts(function(o){return function(i){return o.options.sortUpserts&&i.sort(o.options.sortUpserts),r(i,function(){return o.localCol.pendingRemoves(function(r){return n(r,t,e)},e)},e)}}(this),e)},t}()},{"./utils":15,lodash:"nJZoxB"}],7:[function(t,e){var n,r,o,i,u,c,s,a;a=t("lodash"),i=t("async"),r=t("idb-wrapper"),s=t("./utils"),c=t("./utils").processFind,u=t("./selector").compileSort,e.exports=o=function(){function t(t,e,n){var o;this.collections={};try{this.store=new r({dbVersion:1,storeName:"minimongo_"+t.namespace,keyPath:["col","doc._id"],autoIncrement:!1,onStoreReady:function(t){return function(){return e?e(t):void 0}}(this),onError:n,indexes:[{name:"col",keyPath:"col",unique:!1,multiEntry:!1},{name:"col-state",keyPath:["col","state"],unique:!1,multiEntry:!1}]})}catch(i){return o=i,n&&n(o),void 0}}return t.prototype.addCollection=function(t,e){var r;return r=new n(t,this.store),this[t]=r,this.collections[t]=r,e?e():void 0},t.prototype.removeCollection=function(t,e,n){return delete this[t],delete this.collections[t],this.store.query(function(t){return function(r){var o;return o=a.map(r,function(t){return[t.col,t.doc._id]}),o.length>0?t.store.removeBatch(o,function(){return null!=e?e():void 0},n):null!=e?e():void 0}}(this),{index:"col",keyRange:this.store.makeKeyRange({only:t}),onError:n})},t}(),n=function(){function t(t,e){this.name=t,this.store=e}return t.prototype.find=function(t,e){return{fetch:function(n){return function(r,o){return n._findFetch(t,e,r,o)}}(this)}},t.prototype.findOne=function(t,e,n,r){var o;return a.isFunction(e)&&(o=[{},e,n],e=o[0],n=o[1],r=o[2]),this.find(t,e).fetch(function(t){return null!=n?n(t.length>0?t[0]:null):void 0},r)},t.prototype._findFetch=function(t,e,n,r){return this.store.query(function(r){return r=a.filter(r,function(t){return"removed"!==t.state}),null!=n?n(c(a.pluck(r,"doc"),t,e)):void 0},{index:"col",keyRange:this.store.makeKeyRange({only:this.name}),onError:r})},t.prototype.upsert=function(t,e,n,r){var o,i,u;return u=s.regularizeUpsert(t,e,n,r),o=u[0],n=u[1],r=u[2],i=a.map(o,function(t){return function(e){return[t.name,e.doc._id]}}(this)),this.store.getBatch(i,function(e){return function(i){var u;return u=a.map(o,function(t,n){var r;return r=void 0!==t.base?t.base:i[n]&&i[n].doc&&"cached"===i[n].state?i[n].doc:i[n]&&i[n].doc&&"upserted"===i[n].state?i[n].base:null,{col:e.name,state:"upserted",doc:t.doc,base:r}}),e.store.putBatch(u,function(){return n?n(t):void 0},r)}}(this),r)},t.prototype.remove=function(t,e,n){return this.store.get([this.name,t],function(r){return function(o){return null==o&&(o={col:r.name,doc:{_id:t}}),o.state="removed",r.store.put(o,function(){return e?e(t):void 0},n)}}(this))},t.prototype.cache=function(t,e,n,r,o){var i,c,s;return s=function(i){return function(){var c,s;return c=a.object(a.pluck(t,"_id"),t),n.sort&&(s=u(n.sort)),i.find(e,n).fetch(function(e){var u,l;return l=[],u=a.map(e,function(t){return[i.name,t._id]}),0===u.length?(null!=r&&r(),void 0):i.store.getBatch(u,function(u){var f,d,h,p,m;for(f=p=0,m=u.length;m>=0?m>p:p>m;f=m>=0?++p:--p)if(d=u[f],h=e[f],!c[h._id]&&d&&"cached"===d.state){if(n.sort&&n.limit&&t.length===n.limit&&s(h,a.last(t))>=0)continue;l.push([i.name,h._id])}return l.length>0?i.store.removeBatch(l,function(){return null!=r?r():void 0},o):null!=r?r():void 0},o)},o)}}(this),0===t.length?s():(i=a.map(t,function(t){return function(e){return[t.name,e._id]}}(this)),c=[],this.store.getBatch(i,function(e){return function(n){var r,i,u,a,l;for(i=a=0,l=n.length;l>=0?l>a:a>l;i=l>=0?++a:--a)u=n[i],r=t[i],(null==u||"cached"===u.state)&&(!u||!r._rev||!u.doc._rev||r._rev>=u.doc._rev)&&c.push({col:e.name,state:"cached",doc:r});return c.length>0?e.store.putBatch(c,s,o):s()}}(this),o))},t.prototype.pendingUpserts=function(t,e){return this.store.query(function(e){var n;return n=a.map(e,function(t){return{doc:t.doc,base:t.base||null}}),null!=t?t(n):void 0},{index:"col-state",keyRange:this.store.makeKeyRange({only:[this.name,"upserted"]}),onError:e})},t.prototype.pendingRemoves=function(t,e){return this.store.query(function(e){return null!=t?t(a.pluck(a.pluck(e,"doc"),"_id")):void 0},{index:"col-state",keyRange:this.store.makeKeyRange({only:[this.name,"removed"]}),onError:e})},t.prototype.resolveUpserts=function(t,e,n){var r;return r=a.map(t,function(t){return function(e){return[t.name,e.doc._id]}}(this)),this.store.getBatch(r,function(r){return function(o){var i,u,c,s,l;for(u=[],i=s=0,l=t.length;l>=0?l>s:s>l;i=l>=0?++s:--s)c=o[i],c&&"upserted"===c.state&&(a.isEqual(c.doc,t[i].doc)?(c.state="cached",u.push(c)):(c.base=t[i].doc,u.push(c)));return u.length>0?r.store.putBatch(u,function(){return e?e():void 0},n):e?e():void 0}}(this),n)},t.prototype.resolveRemove=function(t,e,n){return this.store.get([this.name,t],function(r){return function(o){return o?"removed"===o.state?r.store.remove([r.name,t],function(){return null!=e?e():void 0},n):void 0:(null!=e&&e(),void 0)}}(this))},t.prototype.seed=function(t,e,n){var r,o;return a.isArray(t)||(t=[t]),r=a.map(t,function(t){return function(e){return[t.name,e._id]}}(this)),o=[],this.store.getBatch(r,function(r){return function(i){var u,c,s,a,l;for(c=a=0,l=i.length;l>=0?l>a:a>l;c=l>=0?++a:--a)s=i[c],u=t[c],null==s&&o.push({col:r.name,state:"cached",doc:u});return o.length>0?r.store.putBatch(o,function(){return null!=e?e():void 0},n):null!=e?e():void 0}}(this),n)},t.prototype.cacheOne=function(t,e,n){return this.store.get([this.name,t._id],function(r){return function(o){return o&&t._rev&&o.doc._rev&&t._rev<o.doc._rev?(null!=e&&e(),void 0):(null==o&&(o={col:r.name,state:"cached",doc:t}),"cached"===o.state?(o.doc=t,r.store.put(o,function(){return null!=e?e():void 0},n)):null!=e?e():void 0)}}(this))},t.prototype.uncache=function(t,e,n){var r;return r=s.compileDocumentSelector(t),this.store.query(function(t){return function(o){var i;return o=a.filter(o,function(t){return"cached"===t.state&&r(t.doc)}),i=a.map(o,function(e){return[t.name,e.doc._id]}),i.length>0?t.store.removeBatch(i,function(){return null!=e?e():void 0},n):null!=e?e():void 0}}(this),{index:"col",keyRange:this.store.makeKeyRange({only:this.name}),onError:n})},t}()},{"./selector":14,"./utils":15,async:18,"idb-wrapper":21,lodash:"nJZoxB"}],8:[function(t,e){var n,r,o,i,u,c;c=t("lodash"),u=t("./utils"),i=t("./utils").processFind,o=t("./selector").compileSort,e.exports=r=function(){function t(t,e){this.collections={},t&&t.namespace&&window.localStorage&&(this.namespace=t.namespace),e&&e(this)}return t.prototype.addCollection=function(t,e){var r,o;return this.namespace&&(o=this.namespace+"."+t),r=new n(t,o),this[t]=r,this.collections[t]=r,null!=e?e():void 0},t.prototype.removeCollection=function(t,e){var n,r,o,i,u,c,s,a;if(this.namespace&&window.localStorage){for(i=[],n=u=0,a=window.localStorage.length;a>=0?a>u:u>a;n=a>=0?++u:--u)i.push(window.localStorage.key(n));for(c=0,s=i.length;s>c;c++)r=i[c],o=this.namespace+"."+t,r.substring(0,o.length)===o&&window.localStorage.removeItem(r)}return delete this[t],delete this.collections[t],null!=e?e():void 0},t}(),n=function(){function t(t,e){this.name=t,this.namespace=e,this.items={},this.upserts={},this.removes={},window.localStorage&&null!=e&&this.loadStorage()}return t.prototype.loadStorage=function(){var t,e,n,r,o,i,u,s,a,l;for(this.itemNamespace=this.namespace+"_",e=u=0,l=window.localStorage.length;l>=0?l>u:u>l;e=l>=0?++u:--u)r=window.localStorage.key(e),r.substring(0,this.itemNamespace.length)===this.itemNamespace&&(n=JSON.parse(window.localStorage[r]),this.items[n._id]=n);for(i=window.localStorage[this.namespace+"upserts"]?JSON.parse(window.localStorage[this.namespace+"upserts"]):[],s=0,a=i.length;a>s;s++)r=i[s],this.upserts[r]={doc:this.items[r]},t=window.localStorage[this.namespace+"upsertbase_"+r]?JSON.parse(window.localStorage[this.namespace+"upsertbase_"+r]):null,this.upserts[r].base=t;return o=window.localStorage[this.namespace+"removes"]?JSON.parse(window.localStorage[this.namespace+"removes"]):[],this.removes=c.object(c.pluck(o,"_id"),o)},t.prototype.find=function(t,e){return{fetch:function(n){return function(r,o){return n._findFetch(t,e,r,o)}}(this)}},t.prototype.findOne=function(t,e,n,r){var o;return c.isFunction(e)&&(o=[{},e,n],e=o[0],n=o[1],r=o[2]),this.find(t,e).fetch(function(t){return null!=n?n(t.length>0?t[0]:null):void 0},r)},t.prototype._findFetch=function(t,e,n){return null!=n?n(i(c.cloneDeep(c.values(this.items)),t,e)):void 0},t.prototype.upsert=function(t,e,n,r){var o,i,s,a,l;for(l=u.regularizeUpsert(t,e,n,r),i=l[0],n=l[1],r=l[2],s=0,a=i.length;a>s;s++)o=i[s],void 0===o.base&&(o.base=this.upserts[o.doc._id]?this.upserts[o.doc._id].base:this.items[o.doc._id]||null),o=c.cloneDeep(o),this._putItem(o.doc),this._putUpsert(o);return n?n(t):void 0},t.prototype.remove=function(t,e){return c.has(this.items,t)?(this._putRemove(this.items[t]),this._deleteItem(t),this._deleteUpsert(t)):this._putRemove({_id:t}),null!=e?e():void 0},t.prototype._putItem=function(t){return this.items[t._id]=t,this.namespace?window.localStorage[this.itemNamespace+t._id]=JSON.stringify(t):void 0},t.prototype._deleteItem=function(t){return delete this.items[t],this.namespace?window.localStorage.removeItem(this.itemNamespace+t):void 0},t.prototype._putUpsert=function(t){return this.upserts[t.doc._id]=t,this.namespace?(window.localStorage[this.namespace+"upserts"]=JSON.stringify(c.keys(this.upserts)),window.localStorage[this.namespace+"upsertbase_"+t.doc._id]=JSON.stringify(t.base)):void 0},t.prototype._deleteUpsert=function(t){return delete this.upserts[t],this.namespace?window.localStorage[this.namespace+"upserts"]=JSON.stringify(c.keys(this.upserts)):void 0},t.prototype._putRemove=function(t){return this.removes[t._id]=t,this.namespace?window.localStorage[this.namespace+"removes"]=JSON.stringify(c.values(this.removes)):void 0},t.prototype._deleteRemove=function(t){return delete this.removes[t],this.namespace?window.localStorage[this.namespace+"removes"]=JSON.stringify(c.values(this.removes)):void 0},t.prototype.cache=function(t,e,n,r,i){var u,s,a,l,f;for(l=0,f=t.length;f>l;l++)u=t[l],this.cacheOne(u);return s=c.object(c.pluck(t,"_id"),t),n.sort&&(a=o(n.sort)),this.find(e,n).fetch(function(e){return function(o){var i,u,l;for(u=0,l=o.length;l>u;u++)if(i=o[u],!s[i._id]&&!c.has(e.upserts,i._id)){if(n.sort&&n.limit&&t.length===n.limit&&a(i,c.last(t))>=0)continue;e._deleteItem(i._id)}return null!=r?r():void 0}}(this),i)},t.prototype.pendingUpserts=function(t){return t(c.values(this.upserts))},t.prototype.pendingRemoves=function(t){return t(c.pluck(this.removes,"_id"))},t.prototype.resolveUpserts=function(t,e){var n,r,o;for(r=0,o=t.length;o>r;r++)n=t[r],this.upserts[n.doc._id]&&(c.isEqual(n.doc,this.upserts[n.doc._id].doc)?this._deleteUpsert(n.doc._id):(this.upserts[n.doc._id].base=n.doc,this._putUpsert(this.upserts[n.doc._id])));return null!=e?e():void 0},t.prototype.resolveRemove=function(t,e){return this._deleteRemove(t),null!=e?e():void 0},t.prototype.seed=function(t,e){var n,r,o;for(c.isArray(t)||(t=[t]),r=0,o=t.length;o>r;r++)n=t[r],c.has(this.items,n._id)||c.has(this.removes,n._id)||this._putItem(n);return null!=e?e():void 0},t.prototype.cacheOne=function(t,e){var n;return c.has(this.upserts,t._id)||c.has(this.removes,t._id)||(n=this.items[t._id],(!n||!t._rev||!n._rev||t._rev>=n._rev)&&this._putItem(t)),null!=e?e():void 0},t.prototype.uncache=function(t,e){var n,r,o,i,s;for(n=u.compileDocumentSelector(t),s=c.values(this.items),o=0,i=s.length;i>o;o++)r=s[o],null==this.upserts[r._id]&&n(r)&&this._deleteItem(r._id);return null!=e?e():void 0},t}()},{"./selector":14,"./utils":15,lodash:"nJZoxB"}],9:[function(t,e){var n,r,o,i,u,c;c=t("lodash"),u=t("./utils"),i=t("./utils").processFind,o=t("./selector").compileSort,e.exports=r=function(){function t(t,e){this.collections={},e&&e(this)}return t.prototype.addCollection=function(t,e){var r;return r=new n(t),this[t]=r,this.collections[t]=r,null!=e?e():void 0},t.prototype.removeCollection=function(t,e){return delete this[t],delete this.collections[t],null!=e?e():void 0},t}(),n=function(){function t(t){this.name=t,this.items={},this.upserts={},this.removes={}}return t.prototype.find=function(t,e){return{fetch:function(n){return function(r,o){return n._findFetch(t,e,r,o)}}(this)}},t.prototype.findOne=function(t,e,n,r){var o;return c.isFunction(e)&&(o=[{},e,n],e=o[0],n=o[1],r=o[2]),this.find(t,e).fetch(function(t){return null!=n?n(t.length>0?t[0]:null):void 0},r)},t.prototype._findFetch=function(t,e,n){return setTimeout(function(r){return function(){var o;return o=i(c.values(r.items),t,e),null!=n?n(o):void 0}}(this),0)},t.prototype.upsert=function(t,e,n,r){var o,i,c,s,a;for(a=u.regularizeUpsert(t,e,n,r),i=a[0],n=a[1],r=a[2],c=0,s=i.length;s>c;c++)o=i[c],void 0===o.base&&(o.base=this.upserts[o.doc._id]?this.upserts[o.doc._id].base:this.items[o.doc._id]||null),this.items[o.doc._id]=o.doc,this.upserts[o.doc._id]=o;return n?n(t):void 0},t.prototype.remove=function(t,e){return c.has(this.items,t)?(this.removes[t]=this.items[t],delete this.items[t],delete this.upserts[t]):this.removes[t]={_id:t},null!=e?e():void 0},t.prototype.cache=function(t,e,n,r,i){var u,s,a,l,f;for(l=0,f=t.length;f>l;l++)u=t[l],this.cacheOne(u);return s=c.object(c.pluck(t,"_id"),t),n.sort&&(a=o(n.sort)),this.find(e,n).fetch(function(e){return function(o){var i,u,l;for(u=0,l=o.length;l>u;u++)if(i=o[u],!s[i._id]&&!c.has(e.upserts,i._id)){if(n.sort&&n.limit&&t.length===n.limit&&a(i,c.last(t))>=0)continue;delete e.items[i._id]}return null!=r?r():void 0}}(this),i)},t.prototype.pendingUpserts=function(t){return t(c.values(this.upserts))},t.prototype.pendingRemoves=function(t){return t(c.pluck(this.removes,"_id"))},t.prototype.resolveUpserts=function(t,e){var n,r,o,i;for(o=0,i=t.length;i>o;o++)r=t[o],n=r.doc._id,this.upserts[n]&&(c.isEqual(r.doc,this.upserts[n].doc)?delete this.upserts[n]:this.upserts[n].base=r.doc);return null!=e?e():void 0},t.prototype.resolveRemove=function(t,e){return delete this.removes[t],null!=e?e():void 0},t.prototype.seed=function(t,e){var n,r,o;for(c.isArray(t)||(t=[t]),r=0,o=t.length;o>r;r++)n=t[r],c.has(this.items,n._id)||c.has(this.removes,n._id)||(this.items[n._id]=n);return null!=e?e():void 0},t.prototype.cacheOne=function(t,e){var n;return c.has(this.upserts,t._id)||c.has(this.removes,t._id)||(n=this.items[t._id],(!n||!t._rev||!n._rev||t._rev>=n._rev)&&(this.items[t._id]=t)),null!=e?e():void 0},t.prototype.uncache=function(t,e){var n,r;return n=u.compileDocumentSelector(t),r=c.filter(c.values(this.items),function(t){return function(e){return null!=t.upserts[e._id]||!n(e)}}(this)),this.items=c.object(c.pluck(r,"_id"),r),null!=e?e():void 0},t}()},{"./selector":14,"./utils":15,lodash:"nJZoxB"}],10:[function(t,e){var n,r,o,i,u,c,s;s=t("lodash"),n=t("jquery"),i=t("async"),c=t("./utils"),u=t("./jQueryHttpClient"),e.exports=o=function(){function t(t,e,n){this.url=t,this.client=e,this.collections={},this.httpClient=n||u}return t.prototype.addCollection=function(t,e,n,o){var i,u,c;return null==e&&(e={}),s.isFunction(e)&&(c=[{},e,n],e=c[0],n=c[1],o=c[2]),u=e.url||this.url+t,i=new r(t,u,this.client,this.httpClient),this[t]=i,this.collections[t]=i,null!=n?n():void 0},t.prototype.removeCollection=function(t,e){return delete this[t],delete this.collections[t],null!=e?e():void 0},t}(),r=function(){function t(t,e,n,r){this.name=t,this.url=e,this.client=n,this.httpClient=r}return t.prototype.find=function(t,e){return null==e&&(e={}),{fetch:function(n){return function(r,o){var i;return i={},e.sort&&(i.sort=JSON.stringify(e.sort)),e.limit&&(i.limit=e.limit),e.skip&&(i.skip=e.skip),e.fields&&(i.fields=JSON.stringify(e.fields)),n.client&&(i.client=n.client),i.selector=JSON.stringify(t||{}),"undefined"!=typeof navigator&&null!==navigator&&-1!==navigator.userAgent.toLowerCase().indexOf("android 2.3")&&(i._=(new Date).getTime()),n.httpClient("GET",n.url,i,null,r,o)}}(this)}},t.prototype.findOne=function(t,e,n,r){var o,i;return null==e&&(e={}),s.isFunction(e)&&(i=[{},e,n],e=i[0],n=i[1],r=i[2]),o={},e.sort&&(o.sort=JSON.stringify(e.sort)),o.limit=1,this.client&&(o.client=this.client),o.selector=JSON.stringify(t||{}),"undefined"!=typeof navigator&&null!==navigator&&-1!==navigator.userAgent.toLowerCase().indexOf("android 2.3")&&(o._=(new Date).getTime()),this.httpClient("GET",this.url,o,null,function(t){return t&&t.length>0?n(t[0]):n(null)},r)},t.prototype.upsert=function(t,e,n,r){var o,u,a;if(a=c.regularizeUpsert(t,e,n,r),o=a[0],n=a[1],r=a[2],!this.client)throw new Error("Client required to upsert");return u=[],i.eachLimit(o,8,function(t){return function(e,n){var r;return e.doc._id||(e.doc._id=c.createUid()),r={client:t.client},"undefined"!=typeof navigator&&null!==navigator&&-1!==navigator.userAgent.toLowerCase().indexOf("android 2.3")&&(r._=(new Date).getTime()),e.base?t.httpClient("PATCH",t.url+"/"+e.doc._id,r,e,function(t){return u.push(t),n()},function(t){return n(t)}):t.httpClient("POST",t.url,r,e.doc,function(t){return u.push(t),n()},function(t){return n(t)})}}(this),function(e){if(e)return r&&r(e),void 0;if(s.isArray(t)){if(n)return n(u)}else if(n)return n(u[0])})},t.prototype.remove=function(t,e,n){var r;if(!this.client)throw new Error("Client required to remove");return r={client:this.client},this.httpClient("DELETE",this.url+"/"+t,r,null,e,function(t){return 410===t.status?e():n(t)})},t}()},{"./jQueryHttpClient":13,"./utils":15,async:18,jquery:"/nayFu",lodash:"nJZoxB"}],11:[function(t,e){var n,r,o,i;i=t("lodash"),o=t("./utils"),e.exports=r=function(){function t(t,e){this.collections={},this.masterDb=t,this.replicaDb=e}return t.prototype.addCollection=function(t,e){var r;return r=new n(t,this.masterDb[t],this.replicaDb[t]),this[t]=r,this.collections[t]=r,null!=e?e():void 0},t.prototype.removeCollection=function(t,e){return delete this[t],delete this.collections[t],null!=e?e():void 0},t}(),n=function(){function t(t,e,n){this.name=t,this.masterCol=e,this.replicaCol=n}return t.prototype.find=function(t,e){return this.masterCol.find(t,e)},t.prototype.findOne=function(t,e,n,r){return this.masterCol.findOne(t,e,n,r)},t.prototype.upsert=function(t,e,n,r){var u,c;return c=o.regularizeUpsert(t,e,n,r),u=c[0],n=c[1],r=c[2],this.masterCol.upsert(i.pluck(u,"doc"),i.pluck(u,"base"),function(e){return function(){return e.replicaCol.upsert(i.pluck(u,"doc"),i.pluck(u,"base"),function(){return n(t)},r)}}(this),r)},t.prototype.remove=function(t,e,n){return this.masterCol.remove(t,function(r){return function(){return r.replicaCol.remove(t,e,n)}}(this),n)},t.prototype.cache=function(t,e,n,r,o){return this.masterCol.cache(t,e,n,function(i){return function(){return i.replicaCol.cache(t,e,n,r,o)}}(this),o)},t.prototype.pendingUpserts=function(t,e){return this.masterCol.pendingUpserts(t,e)},t.prototype.pendingRemoves=function(t,e){return this.masterCol.pendingRemoves(t,e)},t.prototype.resolveUpserts=function(t,e,n){return this.masterCol.resolveUpserts(t,function(r){return function(){return r.replicaCol.resolveUpserts(t,e,n)}}(this),n)},t.prototype.resolveRemove=function(t,e,n){return this.masterCol.resolveRemove(t,function(r){return function(){return r.replicaCol.resolveRemove(t,e,n)}}(this),n)},t.prototype.seed=function(t,e,n){return this.masterCol.seed(t,function(r){return function(){return r.replicaCol.seed(t,e,n)}}(this),n)},t.prototype.cacheOne=function(t,e,n){return this.masterCol.cacheOne(t,function(r){return function(){return r.replicaCol.cacheOne(t,e,n)}}(this),n)},t.prototype.uncache=function(t,e,n){return this.masterCol.uncache(t,function(r){return function(){return r.replicaCol.uncache(t,e,n)}}(this),n)},t}()},{"./utils":15,lodash:"nJZoxB"}],12:[function(t,e){var n,r,o,i,u,c,s,a;a=t("lodash"),o=t("async"),s=t("./utils"),c=t("./utils").processFind,i=t("./selector").compileSort,u=function(){},e.exports=r=function(){function t(t,e,n){var r,o,i,c;this.collections={};try{if(this.db=window.openDatabase("minimongo_"+t.namespace,"","Minimongo:"+t.namespace,5242880),!this.db)return n(new Error("Failed to create database"))}catch(s){return o=s,n&&n(o),void 0}return i=function(t){return t.executeSql("CREATE TABLE docs (\n  col TEXT NOT NULL,\n  id TEXT NOT NULL,\n  state TEXT NOT NULL,\n  doc TEXT,\n  PRIMARY KEY (col, id));",[],u,function(t,e){return n(e)})},c=function(t){return t.executeSql("ALTER TABLE docs ADD COLUMN base TEXT;",[],u,function(t,e){return n(e)})},r=function(t){return function(){return"1.0"===t.db.version?t.db.changeVersion("1.0","2.0",c,n,function(){return e?e(t):void 0}):"2.0"!==t.db.version?n("Unknown db version "+t.db.version):e?e(t):void 0}}(this),this.db.version?r():this.db.changeVersion("","1.0",i,n,r),this.db}return t.prototype.addCollection=function(t,e){var r;return r=new n(t,this.db),this[t]=r,this.collections[t]=r,e?e():void 0},t.prototype.removeCollection=function(t,e,n){return delete this[t],delete this.collections[t],this.db.transaction(function(r){return r.executeSql("DELETE FROM docs WHERE col = ?",[t],e,function(t,e){return n(e)})},n)},t}(),n=function(){function t(t,e){this.name=t,this.db=e}return t.prototype.find=function(t,e){return{fetch:function(n){return function(r,o){return n._findFetch(t,e,r,o)}}(this)}},t.prototype.findOne=function(t,e,n,r){var o;return a.isFunction(e)&&(o=[{},e,n],e=o[0],n=o[1],r=o[2]),this.find(t,e).fetch(function(t){return null!=n?n(t.length>0?t[0]:null):void 0},r)},t.prototype._findFetch=function(t,e,n,r){return r=r||function(){},this.db.readTransaction(function(o){return function(i){return i.executeSql("SELECT * FROM docs WHERE col = ?",[o.name],function(r,o){var i,u,s,a,l;for(i=[],u=a=0,l=o.rows.length;l>=0?l>a:a>l;u=l>=0?++a:--a)s=o.rows.item(u),"removed"!==s.state&&i.push(JSON.parse(s.doc));return null!=n?n(c(i,t,e)):void 0},function(t,e){return r(e)})}}(this),r)},t.prototype.upsert=function(t,e,n,r){var i,c;return c=s.regularizeUpsert(t,e,n,r),i=c[0],n=c[1],r=c[2],r=r||function(){},this.db.transaction(function(t){return function(n){var c;return c=a.map(i,function(t){return t.doc._id}),e={},o.eachSeries(c,function(o,i){return n.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[t.name,o],function(t,r){var o;return n=t,r.rows.length>0&&(o=r.rows.item(0),"upserted"===o.state?e[o.id]=o.base?JSON.parse(o.base):null:"cached"===o.state&&(e[o.id]=JSON.parse(o.doc))),i()},function(t,e){return r(e)})},function(){var o,c,s,a,l,f;for(f=[],a=0,l=i.length;l>a;a++)s=i[a],c=s.doc._id,o=void 0!==s.base?s.base:e[c]?e[c]:null,f.push(n.executeSql("INSERT OR REPLACE INTO docs (col, id, state, doc, base) VALUES (?, ?, ?, ?, ?)",[t.name,s.doc._id,"upserted",JSON.stringify(s.doc),JSON.stringify(o)],u,function(t,e){return r(e)}));return f})}}(this),r,function(){return n?n(t):void 0})},t.prototype.remove=function(t,e,n){return n=n||function(){},this.db.transaction(function(r){return function(o){return o.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[r.name,t],function(o,i){return i.rows.length>0?o.executeSql('UPDATE docs SET state="removed" WHERE col = ? AND id = ?',[r.name,t],function(){return e?e(t):void 0
},function(t,e){return n(e)}):o.executeSql("INSERT INTO docs (col, id, state, doc) VALUES (?, ?, ?, ?)",[r.name,t,"removed",JSON.stringify({_id:t})],function(){return e?e(t):void 0},function(t,e){return n(e)})},function(t,e){return n(e)})}}(this),n)},t.prototype.cache=function(t,e,n,r,u){return u=u||function(){},this.db.transaction(function(c){return function(s){return o.eachSeries(t,function(t,e){return s.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[c.name,t._id],function(n,r){var o;return 0===r.rows.length||"cached"===r.rows.item(0).state?(o=r.rows.length>0?JSON.parse(r.rows.item(0).doc):null,!o||!t._rev||!o._rev||t._rev>=o._rev?n.executeSql("INSERT OR REPLACE INTO docs (col, id, state, doc) VALUES (?, ?, ?, ?)",[c.name,t._id,"cached",JSON.stringify(t)],function(){return e()},function(t,e){return u(e)}):e()):e()},function(t,e){return u(e)})},function(s){var l,f;return s?(u&&u(s),void 0):(l=a.object(a.pluck(t,"_id"),t),n.sort&&(f=i(n.sort)),c.find(e,n).fetch(function(e){return c.db.transaction(function(i){return o.eachSeries(e,function(e,r){return i.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[c.name,e._id],function(o,i){return!l[e._id]&&i.rows.length>0&&"cached"===i.rows.item(0).state?n.sort&&n.limit&&t.length===n.limit&&f(e,a.last(t))>=0?r():o.executeSql("DELETE FROM docs WHERE col = ? AND id = ?",[c.name,e._id],function(){return r()},function(t,e){return u(e)}):r()},function(t,e){return u(e)})},function(t){return null!=t?(null!=u&&u(t),void 0):null!=r?r():void 0})},u)},u))})}}(this),u)},t.prototype.pendingUpserts=function(t,e){return e=e||function(){},this.db.readTransaction(function(n){return function(r){return r.executeSql("SELECT * FROM docs WHERE col = ? AND state = ?",[n.name,"upserted"],function(e,n){var r,o,i,u,c;for(r=[],o=u=0,c=n.rows.length;c>=0?c>u:u>c;o=c>=0?++u:--u)i=n.rows.item(o),r.push({doc:JSON.parse(i.doc),base:i.base?JSON.parse(i.base):null});return null!=t?t(r):void 0},function(t,n){return e(n)})}}(this),e)},t.prototype.pendingRemoves=function(t,e){return e=e||function(){},this.db.readTransaction(function(n){return function(r){return r.executeSql("SELECT * FROM docs WHERE col = ? AND state = ?",[n.name,"removed"],function(e,n){var r,o,i,u,c;for(r=[],o=u=0,c=n.rows.length;c>=0?c>u:u>c;o=c>=0?++u:--u)i=n.rows.item(o),r.push(JSON.parse(i.doc)._id);return null!=t?t(r):void 0},function(t,n){return e(n)})}}(this),e)},t.prototype.resolveUpserts=function(t,e,n){return n=n||function(){},this.db.transaction(function(r){return function(i){return o.eachSeries(t,function(t,e){return i.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[r.name,t.doc._id],function(o,i){return i.rows.length>0&&"upserted"===i.rows.item(0).state?a.isEqual(JSON.parse(i.rows.item(0).doc),t.doc)?(o.executeSql('UPDATE docs SET state="cached" WHERE col = ? AND id = ?',[r.name,t.doc._id],u,function(t,e){return n(e)}),e()):(o.executeSql("UPDATE docs SET base=? WHERE col = ? AND id = ?",[JSON.stringify(t.doc),r.name,t.doc._id],u,function(t,e){return n(e)}),e()):e()},function(t,e){return n(e)})},function(t){return t?n(t):e?e():void 0})}}(this),n)},t.prototype.resolveRemove=function(t,e,n){return n=n||function(){},this.db.transaction(function(r){return function(o){return o.executeSql('DELETE FROM docs WHERE state="removed" AND col = ? AND id = ?',[r.name,t],function(){return e?e(t):void 0},function(t,e){return n(e)})}}(this),n)},t.prototype.seed=function(t,e,n){return a.isArray(t)||(t=[t]),n=n||function(){},this.db.transaction(function(r){return function(i){return o.eachSeries(t,function(t,e){return i.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[r.name,t._id],function(o,i){return 0===i.rows.length?o.executeSql("INSERT OR REPLACE INTO docs (col, id, state, doc) VALUES (?, ?, ?, ?)",[r.name,t._id,"cached",JSON.stringify(t)],function(){return e()},function(t,e){return n(e)}):e()},function(t,e){return n(e)})},function(t){if(t){if(n)return n(t)}else if(e)return e()})}}(this),n)},t.prototype.cacheOne=function(t,e,n){return n=n||function(){},this.db.transaction(function(r){return function(o){return o.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[r.name,t._id],function(o,i){var u;if(0===i.rows.length||"cached"===i.rows.item(0).state){if(u=i.rows.length>0?JSON.parse(i.rows.item(0).doc):null,!u||!t._rev||!u._rev||t._rev>=u._rev)return o.executeSql("INSERT OR REPLACE INTO docs (col, id, state, doc) VALUES (?, ?, ?, ?)",[r.name,t._id,"cached",JSON.stringify(t)],function(){return e?e(t):void 0},function(t,e){return n(e)});if(e)return e(t)}else if(e)return e(t)},function(t,e){return n(e)})}}(this),n)},t.prototype.uncache=function(t,e,n){var r;return r=s.compileDocumentSelector(t),n=n||function(){},this.db.transaction(function(t){return function(i){return i.executeSql("SELECT * FROM docs WHERE col = ? AND state = ?",[t.name,"cached"],function(i,u){var c,s,a,l,f,d;for(l=[],s=f=0,d=u.rows.length;d>=0?d>f:f>d;s=d>=0?++f:--f)a=u.rows.item(s),c=JSON.parse(a.doc),r(c)&&l.push(c._id);return o.eachSeries(l,function(e,r){return i.executeSql('DELETE FROM docs WHERE state="cached" AND col = ? AND id = ?',[t.name,e],function(){return r()},function(t,e){return n(e)})},function(t){if(t){if(n)return n(t)}else if(e)return e()})},function(t,e){return n(e)})}}(this),n)},t}()},{"./selector":14,"./utils":15,async:18,lodash:"nJZoxB"}],13:[function(t,e){e.exports=function(t,e,n,r,o,i){var u,c;if(u=e+"?"+$.param(n),"GET"===t)c=$.getJSON(u);else if("DELETE"===t)c=$.ajax(u,{type:"DELETE"});else{if("POST"!==t&&"PATCH"!==t)throw new Error("Unknown method "+t);c=$.ajax(u,{data:JSON.stringify(r),contentType:"application/json",type:t})}return c.done(function(t){return o(t||null)}),c.fail(function(t){return i?i(t):void 0})}},{}],14:[function(t,e,n){LocalCollection={},EJSON=t("./EJSON");var r=t("lodash"),o=function(t){return r.isArray(t)&&!EJSON.isBinary(t)},i=function(t,e){return o(t)?r.any(t,e):e(t)},u=function(t,e){return e(t)?!0:o(t)&&r.any(t,e)},c=function(t){var e=void 0;for(var n in t){var r="$"===n.substr(0,1);if(void 0===e)e=r;else if(e!==r)throw new Error("Inconsistent selector: "+t)}return!!e},s=function(t){if(null==t)return function(t){return i(t,function(t){return null==t})};if(!r.isObject(t))return function(e){return i(e,function(e){return e===t})};if(t instanceof RegExp)return function(e){return void 0===e?!1:i(e,function(e){return t.test(e)})};if(o(t))return function(e){return o(e)?u(e,function(e){return LocalCollection._f._equal(t,e)}):!1};if(c(t)){var e=[];return r.each(t,function(n,o){if(!r.has(l,o))throw new Error("Unrecognized operator: "+o);e.push(l[o](n,t.$options))}),function(t){return r.all(e,function(e){return e(t)})}}return function(e){return i(e,function(e){return LocalCollection._f._equal(t,e)})}},a={$and:function(t){if(!o(t)||r.isEmpty(t))throw Error("$and/$or/$nor must be nonempty array");var e=r.map(t,f);return function(t){return r.all(e,function(e){return e(t)})}},$or:function(t){if(!o(t)||r.isEmpty(t))throw Error("$and/$or/$nor must be nonempty array");var e=r.map(t,f);return function(t){return r.any(e,function(e){return e(t)})}},$nor:function(t){if(!o(t)||r.isEmpty(t))throw Error("$and/$or/$nor must be nonempty array");var e=r.map(t,f);return function(t){return r.all(e,function(e){return!e(t)})}},$where:function(t){return t instanceof Function||(t=Function("return "+t)),function(e){return t.call(e)}}},l={$in:function(t){if(!o(t))throw new Error("Argument to $in must be array");var e=null;return r.all(t,r.isString)&&(e=r.indexBy(t)),function(n){return u(n,function(n){return r.isString(n)&&null!==e?void 0!=e[n]:r.any(t,function(t){return LocalCollection._f._equal(t,n)})})}},$all:function(t){if(!o(t))throw new Error("Argument to $all must be array");return function(e){return o(e)?r.all(t,function(t){return r.any(e,function(e){return LocalCollection._f._equal(t,e)})}):!1}},$lt:function(t){return function(e){return i(e,function(e){return LocalCollection._f._cmp(e,t)<0})}},$lte:function(t){return function(e){return i(e,function(e){return LocalCollection._f._cmp(e,t)<=0})}},$gt:function(t){return function(e){return i(e,function(e){return LocalCollection._f._cmp(e,t)>0})}},$gte:function(t){return function(e){return i(e,function(e){return LocalCollection._f._cmp(e,t)>=0})}},$ne:function(t){return function(e){return!u(e,function(e){return LocalCollection._f._equal(e,t)})}},$nin:function(t){if(!o(t))throw new Error("Argument to $nin must be array");var e=l.$in(t);return function(t){return void 0===t?!0:!e(t)}},$exists:function(t){return function(e){return t===(void 0!==e)}},$mod:function(t){var e=t[0],n=t[1];return function(t){return i(t,function(t){return t%e===n})}},$size:function(t){return function(e){return o(e)&&t===e.length}},$type:function(t){return function(e){return void 0===e?!1:i(e,function(e){return LocalCollection._f._type(e)===t})}},$regex:function(t,e){if(void 0!==e){if(/[^gim]/.test(e))throw new Error("Only the i, m, and g regexp options are supported");var n=t instanceof RegExp?t.source:t;t=new RegExp(n,e)}else t instanceof RegExp||(t=new RegExp(t));return function(e){return void 0===e?!1:i(e,function(e){return t.test(e)})}},$options:function(){return function(){return!0}},$elemMatch:function(t){var e=f(t);return function(t){return o(t)?r.any(t,function(t){return e(t)}):!1}},$not:function(t){var e=s(t);return function(t){return!e(t)}},$near:function(){return function(){return!0}},$geoIntersects:function(){return function(){return!0}}};LocalCollection._f={_type:function(t){return"number"==typeof t?1:"string"==typeof t?2:"boolean"==typeof t?8:o(t)?4:null===t?10:t instanceof RegExp?11:"function"==typeof t?13:t instanceof Date?9:EJSON.isBinary(t)?5:t instanceof Meteor.Collection.ObjectID?7:3},_equal:function(t,e){return EJSON.equals(t,e,{keyOrderSensitive:!0})},_typeorder:function(t){return[-1,1,2,3,4,5,-1,6,7,8,0,9,-1,100,2,100,1,8,1][t]},_cmp:function(t,e){if(void 0===t)return void 0===e?0:-1;if(void 0===e)return 1;var n=LocalCollection._f._type(t),r=LocalCollection._f._type(e),o=LocalCollection._f._typeorder(n),i=LocalCollection._f._typeorder(r);if(o!==i)return i>o?-1:1;if(n!==r)throw Error("Missing type coercion logic in _cmp");if(7===n&&(n=r=2,t=t.toHexString(),e=e.toHexString()),9===n&&(n=r=1,t=t.getTime(),e=e.getTime()),1===n)return t-e;if(2===r)return e>t?-1:t===e?0:1;if(3===n){var u=function(t){var e=[];for(var n in t)e.push(n),e.push(t[n]);return e};return LocalCollection._f._cmp(u(t),u(e))}if(4===n)for(var c=0;;c++){if(c===t.length)return c===e.length?0:-1;if(c===e.length)return 1;var s=LocalCollection._f._cmp(t[c],e[c]);if(0!==s)return s}if(5===n){if(t.length!==e.length)return t.length-e.length;for(c=0;c<t.length;c++){if(t[c]<e[c])return-1;if(t[c]>e[c])return 1}return 0}if(8===n)return t?e?0:1:e?-1:0;if(10===n)return 0;if(11===n)throw Error("Sorting not supported on regular expression");if(13===n)throw Error("Sorting not supported on Javascript code");throw Error("Unknown type to sort")}},LocalCollection._matches=function(t,e){return LocalCollection._compileSelector(t)(e)},LocalCollection._makeLookupFunction=function(t){var e,n,i,u=t.indexOf(".");if(-1===u)e=t;else{e=t.substr(0,u);var c=t.substr(u+1);n=LocalCollection._makeLookupFunction(c),i=/^\d+(\.|$)/.test(c)}return function(t){if(null==t)return[void 0];var u=t[e];return n?o(u)&&0===u.length?[void 0]:((!o(u)||i)&&(u=[u]),Array.prototype.concat.apply([],r.map(u,n))):[u]}};var f=function(t){var e=[];return r.each(t,function(t,n){if("$"===n.substr(0,1)){if(!r.has(a,n))throw new Error("Unrecognized logical operator: "+n);e.push(a[n](t))}else{var o=LocalCollection._makeLookupFunction(n),i=s(t);e.push(function(t){var e=o(t);return r.any(e,i)})}}),function(t){return r.all(e,function(e){return e(t)})}};LocalCollection._compileSelector=function(t){if(t instanceof Function)return function(e){return t.call(e)};if(LocalCollection._selectorIsId(t))return function(e){return EJSON.equals(e._id,t)};if(!t||"_id"in t&&!t._id)return function(){return!1};if("boolean"==typeof t||o(t)||EJSON.isBinary(t))throw new Error("Invalid selector: "+t);return f(t)},LocalCollection._compileSort=function(t){var e=[];if(t instanceof Array)for(var n=0;n<t.length;n++)"string"==typeof t[n]?e.push({lookup:LocalCollection._makeLookupFunction(t[n]),ascending:!0}):e.push({lookup:LocalCollection._makeLookupFunction(t[n][0]),ascending:"desc"!==t[n][1]});else{if("object"!=typeof t)throw Error("Bad sort specification: ",JSON.stringify(t));for(var i in t)e.push({lookup:LocalCollection._makeLookupFunction(i),ascending:t[i]>=0})}if(0===e.length)return function(){return 0};var u=function(t,e){var n,i=!0;return r.each(t,function(t){o(t)||(t=[t]),o(t)&&0===t.length&&(t=[void 0]),r.each(t,function(t){if(i)n=t,i=!1;else{var r=LocalCollection._f._cmp(n,t);(e&&r>0||!e&&0>r)&&(n=t)}})}),n};return function(t,n){for(var r=0;r<e.length;++r){var o=e[r],i=u(o.lookup(t),o.ascending),c=u(o.lookup(n),o.ascending),s=LocalCollection._f._cmp(i,c);if(0!==s)return o.ascending?s:-s}return 0}},n.compileDocumentSelector=f,n.compileSort=LocalCollection._compileSort},{"./EJSON":5,lodash:"nJZoxB"}],15:[function(t,e,n){var r,o,i,u,c,s,a,l,f,d,h;h=t("lodash"),r=t("async"),o=t("bowser"),i=t("./selector").compileDocumentSelector,u=t("./selector").compileSort,a=function(){var t;if(!window.localStorage)return!1;try{return window.localStorage.setItem("test","test"),window.localStorage.removeItem("test"),!0}catch(e){return t=e,!1}},n.compileDocumentSelector=i,n.autoselectLocalDb=function(e,n,r){var i,u,c,s,l;return i=t("./IndexedDb"),s=t("./WebSQLDb"),u=t("./LocalStorageDb"),c=t("./MemoryDb"),l=o.browser,a()?window.cordova?(console.log("Selecting WebSQLDb for Cordova"),new s(e,n,r)):l.android||l.ios||l.chrome||l.safari||l.opera||l.blackberry?(console.log("Selecting WebSQLDb for browser"),new s(e,n,function(){return function(t){return console.log("Failed to create WebSQLDb: "+(t?t.message:void 0)),new i(e,n,function(t){return console.log("Failed to create IndexedDb: "+(t?t.message:void 0)),new c(e,n)})}}(this))):l.firefox&&l.version>=16?(console.log("Selecting IndexedDb for browser"),new i(e,n,function(){return function(t){return console.log("Failed to create IndexedDb: "+(t?t.message:void 0)),new c(e,n)}}(this))):(console.log("Selecting LocalStorageDb for fallback"),new u(e,n,r)):new c(e,n)},n.migrateLocalDb=function(e,n,r,o){var i,u,c,s,a;i=t("./HybridDb"),c=new i(e,n),a=e.collections;for(s in a)u=a[s],n[s]&&c.addCollection(s);return c.upload(r,o)},n.cloneLocalDb=function(t,e,n,o){var i,u,c;c=t.collections;for(u in c)i=c[u],e[u]||e.addCollection(u);return r.each(h.values(t.collections),function(){return function(t,n){var o;return o=e[t.name],t.find({}).fetch(function(e){return o.seed(e,function(){return t.pendingUpserts(function(e){return o.upsert(h.pluck(e,"doc"),h.pluck(e,"base"),function(){return t.pendingRemoves(function(t){return r.eachSeries(t,function(t,e){return o.remove(t,function(){return e()},e)},n)},n)},n)},n)},n)},n)}}(this),function(){return function(t){return t?o(t):n()}}(this))},n.processFind=function(t,e,r){var o;return o=h.filter(t,i(e)),o=d(e,o),o=f(e,o),r&&r.sort&&o.sort(u(r.sort)),r&&r.skip&&(o=h.slice(o,r.skip)),r&&r.limit&&(o=h.take(o,r.limit)),r&&r.fields&&(o=n.filterFields(o,r.fields)),o},n.filterFields=function(t,e){return null==e&&(e={}),0===h.keys(e).length?t:h.map(t,function(t){var n,r,o,i,u,c,s,a,l,f,d,p,m,v,y,g,b,E,w,S,_;if(o={},1===h.first(h.values(e))){for(E=h.keys(e).concat(["_id"]),a=0,p=E.length;p>a;a++){for(n=E[a],u=n.split("."),i=t,l=0,m=u.length;m>l;l++)c=u[l],i&&(i=i[c]);if(null!=i){for(r=t,s=o,w=h.initial(u),f=0,v=w.length;v>f;f++)c=w[f],s[c]=s[c]||{},s=s[c],r=r[c];s[h.last(u)]=r[h.last(u)]}}return o}for(t=h.cloneDeep(t),S=h.keys(e),d=0,y=S.length;y>d;d++){for(n=S[d],u=n.split("."),i=t,_=h.initial(u),b=0,g=_.length;g>b;b++)c=_[b],i&&(i=i[c]);null!=i&&delete i[h.last(u)]}return t})},n.createUid=function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e,n;return e=16*Math.random()|0,n="x"===t?e:3&e|8,n.toString(16)})},d=function(t,e){var n,r,o,i;for(o in t)if(i=t[o],null!=i&&i.$near){if(r=i.$near.$geometry,"Point"!==r.type)break;e=h.filter(e,function(t){return t[o]&&"Point"===t[o].type}),n=h.map(e,function(t){return{doc:t,distance:s(r.coordinates[1],r.coordinates[0],t[o].coordinates[1],t[o].coordinates[0])}}),n=h.filter(n,function(t){return t.distance>=0}),n=h.sortBy(n,"distance"),i.$near.$maxDistance&&(n=h.filter(n,function(t){return t.distance<=i.$near.$maxDistance})),e=h.pluck(n,"doc")}return e},l=function(t,e){if(!h.isEqual(h.first(e.coordinates[0]),h.last(e.coordinates[0])))throw new Error("First must equal last");return t.coordinates[0]<Math.min.apply(this,h.map(e.coordinates[0],function(t){return t[0]}))?!1:t.coordinates[1]<Math.min.apply(this,h.map(e.coordinates[0],function(t){return t[1]}))?!1:t.coordinates[0]>Math.max.apply(this,h.map(e.coordinates[0],function(t){return t[0]}))?!1:t.coordinates[1]>Math.max.apply(this,h.map(e.coordinates[0],function(t){return t[1]}))?!1:!0},s=function(t,e,n,r){var o,i,u,s,a,l;return o=6370986,a=c(n-t),l=c(r-e),i=Math.sin(a/2)*Math.sin(a/2)+Math.cos(c(t))*Math.cos(c(n))*Math.sin(l/2)*Math.sin(l/2),u=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),s=o*u},c=function(t){return t*(Math.PI/180)},f=function(t,e){var n,r,o;for(r in t)if(o=t[r],null!=o&&o.$geoIntersects){if(n=o.$geoIntersects.$geometry,"Polygon"!==n.type)break;e=h.filter(e,function(t){return t[r]&&"Point"===t[r].type?l(t[r],n):!1})}return e},n.regularizeUpsert=function(t,e,r,o){var i,u,c,s,a;for(h.isFunction(e)&&(a=[void 0,e,r],e=a[0],r=a[1],o=a[2]),h.isArray(t)?e=e||[]:(t=[t],e=[e]),u=h.map(t,function(t,n){return{doc:t,base:n<e.length?e[n]:void 0}}),c=0,s=u.length;s>c;c++){if(i=u[c],i.doc._id||(i.doc._id=n.createUid()),i.base&&!i.base._id)throw new Error("Base needs _id");if(i.base&&i.base._id!==i.doc._id)throw new Error("Base needs same _id")}return[u,r,o]}},{"./HybridDb":6,"./IndexedDb":7,"./LocalStorageDb":8,"./MemoryDb":9,"./WebSQLDb":12,"./selector":14,async:18,bowser:19,lodash:"nJZoxB"}],lodash:[function(t,e){e.exports=t("nJZoxB")},{}],nJZoxB:[function(t,e){e.exports=window._},{}],18:[function(t,e){(function(t,n){!function(){function r(){}function o(t){return t}function i(t){return!!t}function u(t){return!t}function c(t){return function(){if(null===t)throw new Error("Callback was already called.");t.apply(this,arguments),t=null}}function s(t){return function(){null!==t&&(t.apply(this,arguments),t=null)}}function a(t){return P(t)||"number"==typeof t.length&&t.length>=0&&t.length%1===0}function l(t,e){for(var n=-1,r=t.length;++n<r;)e(t[n],n,t)}function f(t,e){for(var n=-1,r=t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}function d(t){return f(Array(t),function(t,e){return e})}function h(t,e,n){return l(t,function(t,r,o){n=e(n,t,r,o)}),n}function p(t,e){l(U(t),function(n){e(t[n],n)})}function m(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}function v(t){var e,n,r=-1;return a(t)?(e=t.length,function(){return r++,e>r?r:null}):(n=U(t),e=n.length,function(){return r++,e>r?n[r]:null})}function y(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),o=0;n>o;o++)r[o]=arguments[o+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r)}}}function g(t){return function(e,n,r){return t(e,r)}}function b(t){return function(e,n,o){o=s(o||r),e=e||[];var i=v(e);if(0>=t)return o(null);var u=!1,a=0,l=!1;!function f(){if(u&&0>=a)return o(null);for(;t>a&&!l;){var r=i();if(null===r)return u=!0,0>=a&&o(null),void 0;a+=1,n(e[r],r,c(function(t){a-=1,t?(o(t),l=!0):f()}))}}()}}function E(t){return function(e,n,r){return t(j.eachOf,e,n,r)}}function w(t){return function(e,n,r,o){return t(b(n),e,r,o)}}function S(t){return function(e,n,r){return t(j.eachOfSeries,e,n,r)}}function _(t,e,n,o){o=s(o||r),e=e||[];var i=a(e)?[]:{};t(e,function(t,e,r){n(t,function(t,n){i[e]=n,r(t)})},function(t){o(t,i)})}function O(t,e,n,r){var o=[];t(e,function(t,e,r){n(t,function(n){n&&o.push({index:e,value:t}),r()})},function(){r(f(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})}function x(t,e,n,r){O(t,e,function(t,e){n(t,function(t){e(!t)})},r)}function N(t,e,n){return function(r,o,i,u){function c(){u&&u(n(!1,void 0))}function s(t,r,o){return u?(i(t,function(r){u&&e(r)&&(u(n(!0,t)),u=i=!1),o()}),void 0):o()}arguments.length>3?t(r,o,s,c):(u=i,i=o,t(r,s,c))}}function k(t,e){return e}function C(t,e,n){n=n||r;var o=a(e)?[]:{};t(e,function(t,e,n){t(y(function(t,r){r.length<=1&&(r=r[0]),o[e]=r,n(t)}))},function(t){n(t,o)})}function D(t,e,n,r){var o=[];t(e,function(t,e,r){n(t,function(t,e){o=o.concat(e||[]),r(t)})},function(t){r(t,o)})}function R(t,e,n){function o(t,e,n,o){if(null!=o&&"function"!=typeof o)throw new Error("task callback must be a function");return t.started=!0,P(e)||(e=[e]),0===e.length&&t.idle()?j.setImmediate(function(){t.drain()}):(l(e,function(e){var i={data:e,callback:o||r};n?t.tasks.unshift(i):t.tasks.push(i),t.tasks.length===t.concurrency&&t.saturated()}),j.setImmediate(t.process),void 0)}function i(t,e){return function(){u-=1;var n=!1,r=arguments;l(e,function(t){l(s,function(e,r){e!==t||n||(s.splice(r,1),n=!0)}),t.callback.apply(t,r)}),t.tasks.length+u===0&&t.drain(),t.process()}}if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var u=0,s=[],a={tasks:[],concurrency:e,payload:n,saturated:r,empty:r,drain:r,started:!1,paused:!1,push:function(t,e){o(a,t,!1,e)},kill:function(){a.drain=r,a.tasks=[]},unshift:function(t,e){o(a,t,!0,e)},process:function(){for(;!a.paused&&u<a.concurrency&&a.tasks.length;){var e=a.payload?a.tasks.splice(0,a.payload):a.tasks.splice(0,a.tasks.length),n=f(e,function(t){return t.data});0===a.tasks.length&&a.empty(),u+=1,s.push(e[0]);var r=c(i(a,e));t(n,r)}},length:function(){return a.tasks.length},running:function(){return u},workersList:function(){return s},idle:function(){return a.tasks.length+u===0},pause:function(){a.paused=!0},resume:function(){if(a.paused!==!1){a.paused=!1;for(var t=Math.min(a.concurrency,a.tasks.length),e=1;t>=e;e++)j.setImmediate(a.process)}}};return a}function L(t){return y(function(e,n){e.apply(null,n.concat([y(function(e,n){"object"==typeof console&&(e?console.error&&console.error(e):console[t]&&l(n,function(e){console[t](e)}))})]))})}function A(t){return function(e,n,r){t(d(e),n,r)}}function J(t){return y(function(e,n){var r=y(function(n){var r=this,o=n.pop();return t(e,function(t,e,o){t.apply(r,n.concat([o]))},o)});return n.length?r.apply(this,n):r})}function I(t){return y(function(e){var n=e.pop();e.push(function(){var t=arguments;r?j.setImmediate(function(){n.apply(null,t)}):n.apply(null,t)});var r=!0;t.apply(this,e),r=!1})}var T,j={},q="object"==typeof self&&self.self===self&&self||"object"==typeof n&&n.global===n&&n||this;null!=q&&(T=q.async),j.noConflict=function(){return q.async=T,j};var F=Object.prototype.toString,P=Array.isArray||function(t){return"[object Array]"===F.call(t)},$=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},U=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},B="function"==typeof setImmediate&&setImmediate,V=B?function(t){B(t)}:function(t){setTimeout(t,0)};j.nextTick="object"==typeof t&&"function"==typeof t.nextTick?t.nextTick:V,j.setImmediate=B?V:j.nextTick,j.forEach=j.each=function(t,e,n){return j.eachOf(t,g(e),n)},j.forEachSeries=j.eachSeries=function(t,e,n){return j.eachOfSeries(t,g(e),n)},j.forEachLimit=j.eachLimit=function(t,e,n,r){return b(e)(t,g(n),r)},j.forEachOf=j.eachOf=function(t,e,n){function o(t){a--,t?n(t):null===i&&0>=a&&n(null)}n=s(n||r),t=t||[];for(var i,u=v(t),a=0;null!=(i=u());)a+=1,e(t[i],i,c(o));0===a&&n(null)},j.forEachOfSeries=j.eachOfSeries=function(t,e,n){function o(){var r=!0;return null===u?n(null):(e(t[u],u,c(function(t){if(t)n(t);else{if(u=i(),null===u)return n(null);r?j.setImmediate(o):o()}})),r=!1,void 0)}n=s(n||r),t=t||[];var i=v(t),u=i();o()},j.forEachOfLimit=j.eachOfLimit=function(t,e,n,r){b(e)(t,n,r)},j.map=E(_),j.mapSeries=S(_),j.mapLimit=w(_),j.inject=j.foldl=j.reduce=function(t,e,n,r){j.eachOfSeries(t,function(t,r,o){n(e,t,function(t,n){e=n,o(t)})},function(t){r(t,e)})},j.foldr=j.reduceRight=function(t,e,n,r){var i=f(t,o).reverse();j.reduce(i,e,n,r)},j.transform=function(t,e,n,r){3===arguments.length&&(r=n,n=e,e=P(t)?[]:{}),j.eachOf(t,function(t,r,o){n(e,t,r,o)},function(t){r(t,e)})},j.select=j.filter=E(O),j.selectLimit=j.filterLimit=w(O),j.selectSeries=j.filterSeries=S(O),j.reject=E(x),j.rejectLimit=w(x),j.rejectSeries=S(x),j.any=j.some=N(j.eachOf,i,o),j.someLimit=N(j.eachOfLimit,i,o),j.all=j.every=N(j.eachOf,u,u),j.everyLimit=N(j.eachOfLimit,u,u),j.detect=N(j.eachOf,o,k),j.detectSeries=N(j.eachOfSeries,o,k),j.detectLimit=N(j.eachOfLimit,o,k),j.sortBy=function(t,e,n){function r(t,e){var n=t.criteria,r=e.criteria;return r>n?-1:n>r?1:0}j.map(t,function(t,n){e(t,function(e,r){e?n(e):n(null,{value:t,criteria:r})})},function(t,e){return t?n(t):(n(null,f(e.sort(r),function(t){return t.value})),void 0)})},j.auto=function(t,e,n){function o(t){g.unshift(t)}function i(t){var e=m(g,t);e>=0&&g.splice(e,1)}function u(){a--,l(g.slice(0),function(t){t()})}"function"==typeof arguments[1]&&(n=e,e=null),n=s(n||r);var c=U(t),a=c.length;if(!a)return n(null);e||(e=a);var f={},d=0,v=!1,g=[];o(function(){a||n(null,f)}),l(c,function(r){function c(){return e>d&&h(b,function(t,e){return t&&f.hasOwnProperty(e)},!0)&&!f.hasOwnProperty(r)}function s(){c()&&(d++,i(s),l[l.length-1](g,f))}if(!v){for(var a,l=P(t[r])?t[r]:[t[r]],g=y(function(t,e){if(d--,e.length<=1&&(e=e[0]),t){var o={};p(f,function(t,e){o[e]=t}),o[r]=e,v=!0,n(t,o)}else f[r]=e,j.setImmediate(u)}),b=l.slice(0,l.length-1),E=b.length;E--;){if(!(a=t[b[E]]))throw new Error("Has nonexistent dependency in "+b.join(", "));if(P(a)&&m(a,r)>=0)throw new Error("Has cyclic dependencies")}c()?(d++,l[l.length-1](g,f)):o(s)}})},j.retry=function(t,e,n){function r(t,e){if("number"==typeof e)t.times=parseInt(e,10)||i;else{if("object"!=typeof e)throw new Error("Unsupported argument type for 'times': "+typeof e);t.times=parseInt(e.times,10)||i,t.interval=parseInt(e.interval,10)||u}}function o(t,e){function n(t,n){return function(r){t(function(t,e){r(!t||n,{err:t,result:e})},e)}}function r(t){return function(e){setTimeout(function(){e(null)},t)}}for(;s.times;){var o=!(s.times-=1);c.push(n(s.task,o)),!o&&s.interval>0&&c.push(r(s.interval))}j.series(c,function(e,n){n=n[n.length-1],(t||s.callback)(n.err,n.result)})}var i=5,u=0,c=[],s={times:i,interval:u},a=arguments.length;if(1>a||a>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return 2>=a&&"function"==typeof t&&(n=e,e=t),"function"!=typeof t&&r(s,t),s.callback=n,s.task=e,s.callback?o():o},j.waterfall=function(t,e){function n(t){return y(function(r,o){if(r)e.apply(null,[r].concat(o));else{var i=t.next();i?o.push(n(i)):o.push(e),I(t).apply(null,o)}})}if(e=s(e||r),!P(t)){var o=new Error("First argument to waterfall must be an array of functions");return e(o)}return t.length?(n(j.iterator(t))(),void 0):e()},j.parallel=function(t,e){C(j.eachOf,t,e)},j.parallelLimit=function(t,e,n){C(b(e),t,n)},j.series=function(t,e){C(j.eachOfSeries,t,e)},j.iterator=function(t){function e(n){function r(){return t.length&&t[n].apply(null,arguments),r.next()}return r.next=function(){return n<t.length-1?e(n+1):null},r}return e(0)},j.apply=y(function(t,e){return y(function(n){return t.apply(null,e.concat(n))})}),j.concat=E(D),j.concatSeries=S(D),j.whilst=function(t,e,n){if(n=n||r,t()){var o=y(function(r,i){r?n(r):t.apply(this,i)?e(o):n.apply(null,[null].concat(i))});e(o)}else n(null)},j.doWhilst=function(t,e,n){var r=0;return j.whilst(function(){return++r<=1||e.apply(this,arguments)},t,n)},j.until=function(t,e,n){return j.whilst(function(){return!t.apply(this,arguments)},e,n)},j.doUntil=function(t,e,n){return j.doWhilst(t,function(){return!e.apply(this,arguments)},n)},j.during=function(t,e,n){n=n||r;var o=y(function(e,r){e?n(e):(r.push(i),t.apply(this,r))}),i=function(t,r){t?n(t):r?e(o):n(null)};t(i)},j.doDuring=function(t,e,n){var r=0;j.during(function(t){r++<1?t(null,!0):e.apply(this,arguments)},t,n)},j.queue=function(t,e){var n=R(function(e,n){t(e[0],n)},e,1);return n},j.priorityQueue=function(t,e){function n(t,e){return t.priority-e.priority}function o(t,e,n){for(var r=-1,o=t.length-1;o>r;){var i=r+(o-r+1>>>1);n(e,t[i])>=0?r=i:o=i-1}return r}function i(t,e,i,u){if(null!=u&&"function"!=typeof u)throw new Error("task callback must be a function");return t.started=!0,P(e)||(e=[e]),0===e.length?j.setImmediate(function(){t.drain()}):(l(e,function(e){var c={data:e,priority:i,callback:"function"==typeof u?u:r};t.tasks.splice(o(t.tasks,c,n)+1,0,c),t.tasks.length===t.concurrency&&t.saturated(),j.setImmediate(t.process)}),void 0)}var u=j.queue(t,e);return u.push=function(t,e,n){i(u,t,e,n)},delete u.unshift,u},j.cargo=function(t,e){return R(t,1,e)},j.log=L("log"),j.dir=L("dir"),j.memoize=function(t,e){var n={},r={},i=Object.prototype.hasOwnProperty;e=e||o;var u=y(function(o){var u=o.pop(),c=e.apply(null,o);i.call(n,c)?j.setImmediate(function(){u.apply(null,n[c])}):i.call(r,c)?r[c].push(u):(r[c]=[u],t.apply(null,o.concat([y(function(t){n[c]=t;var e=r[c];delete r[c];for(var o=0,i=e.length;i>o;o++)e[o].apply(null,t)})])))});return u.memo=n,u.unmemoized=t,u},j.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},j.times=A(j.map),j.timesSeries=A(j.mapSeries),j.timesLimit=function(t,e,n,r){return j.mapLimit(d(t),e,n,r)},j.seq=function(){var t=arguments;return y(function(e){var n=this,o=e[e.length-1];"function"==typeof o?e.pop():o=r,j.reduce(t,e,function(t,e,r){e.apply(n,t.concat([y(function(t,e){r(t,e)})]))},function(t,e){o.apply(n,[t].concat(e))})})},j.compose=function(){return j.seq.apply(null,Array.prototype.reverse.call(arguments))},j.applyEach=J(j.eachOf),j.applyEachSeries=J(j.eachOfSeries),j.forever=function(t,e){function n(t){return t?o(t):(i(n),void 0)}var o=c(e||r),i=I(t);n()},j.ensureAsync=I,j.constant=y(function(t){var e=[null].concat(t);return function(t){return t.apply(this,e)}}),j.wrapSync=j.asyncify=function(t){return y(function(e){var n,r=e.pop();try{n=t.apply(this,e)}catch(o){return r(o)}$(n)&&"function"==typeof n.then?n.then(function(t){r(null,t)})["catch"](function(t){r(t.message?t:new Error(t))}):r(null,n)})},"object"==typeof e&&e.exports?e.exports=j:"function"==typeof define&&define.amd?define([],function(){return j}):q.async=j}()}).call(this,t("FWaASH"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{FWaASH:20}],19:[function(t,e){!function(t,n){"undefined"!=typeof e&&e.exports?e.exports.browser=n():"function"==typeof define&&define.amd?define(n):this[t]=n()}("bowser",function(){function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}function r(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}var o,i=n(/(ipod|iphone|ipad)/i).toLowerCase(),u=/like android/i.test(t),c=!u&&/android/i.test(t),s=n(/edge\/(\d+(\.\d+)?)/i),a=n(/version\/(\d+(\.\d+)?)/i),l=/tablet/i.test(t),f=!l&&/[^-]mobi/i.test(t);/opera|opr/i.test(t)?o={name:"Opera",opera:e,version:a||n(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(t)?(o={name:"Windows Phone",windowsphone:e},s?(o.msedge=e,o.version=s):(o.msie=e,o.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?o={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?o={name:"Microsoft Edge",msedge:e,version:s}:/chrome|crios|crmo/i.test(t)?o={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:i?(o={name:"iphone"==i?"iPhone":"ipad"==i?"iPad":"iPod"},a&&(o.version=a)):/sailfish/i.test(t)?o={name:"Sailfish",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?o={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(t)?(o={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(o.firefoxos=e)):/silk/i.test(t)?o={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:c?o={name:"Android",version:a}:/phantom/i.test(t)?o={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?o={name:"BlackBerry",blackberry:e,version:a||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(t)?(o={name:"WebOS",webos:e,version:a||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(o.touchpad=e)):o=/bada/i.test(t)?{name:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(t)?{name:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||a}:/safari/i.test(t)?{name:"Safari",safari:e,version:a}:{name:n(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!o.msedge&&/(apple)?webkit/i.test(t)?(o.name=o.name||"Webkit",o.webkit=e,!o.version&&a&&(o.version=a)):!o.opera&&/gecko\//i.test(t)&&(o.name=o.name||"Gecko",o.gecko=e,o.version=o.version||n(/gecko\/(\d+(\.\d+)?)/i)),o.msedge||!c&&!o.silk?i&&(o[i]=e,o.ios=e):o.android=e;
var d="";o.windowsphone?d=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i?(d=n(/os (\d+([_\s]\d+)*) like mac os x/i),d=d.replace(/[_\s]/g,".")):c?d=n(/android[ \/-](\d+(\.\d+)*)/i):o.webos?d=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):o.blackberry?d=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):o.bada?d=n(/bada\/(\d+(\.\d+)*)/i):o.tizen&&(d=n(/tizen[\/\s](\d+(\.\d+)*)/i)),d&&(o.osversion=d);var h=d.split(".")[0];return l||"ipad"==i||c&&(3==h||4==h&&!f)||o.silk?o.tablet=e:(f||"iphone"==i||"ipod"==i||c||o.blackberry||o.webos||o.bada)&&(o.mobile=e),o.msedge||o.msie&&o.version>=10||o.chrome&&o.version>=20||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(".")[0]>=6||o.blackberry&&o.version>=10.1?o.a=e:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(".")[0]<6?o.c=e:o.x=e,o}var e=!0,n=t("undefined"!=typeof navigator?navigator.userAgent:"");return n.test=function(t){for(var e=0;e<t.length;++e){var r=t[e];if("string"==typeof r&&r in n)return!0}return!1},n._detect=t,n})},{}],20:[function(t,e){function n(){}var r=e.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=n,r.addListener=n,r.once=n,r.off=n,r.removeListener=n,r.removeAllListeners=n,r.emit=n,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")}},{}],21:[function(t,e){!function(t,n,r){"use strict";"function"==typeof define?define(n):"undefined"!=typeof e&&e.exports?e.exports=n():r[t]=n()}("IDBStore",function(){"use strict";function t(t,e){var n,r;for(n in e)r=e[n],r!==c[n]&&r!==t[n]&&(t[n]=r);return t}function e(t){return"error"in t.target?"VersionError"==t.target.error.name:"errorCode"in t.target?12==t.target.errorCode:!1}var n=function(t){throw t},r=function(){},o={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:n,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},i=function(t,e){"undefined"==typeof e&&"function"==typeof t&&(e=t),"[object Object]"!=Object.prototype.toString.call(t)&&(t={});for(var n in o)this[n]="undefined"!=typeof t[n]?t[n]:o[n];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,e&&(this.onStoreReady=e);var r="object"==typeof window?window:self,i=this.implementationPreference.filter(function(t){return t in r});this.implementation=i[0],this.idb=r[this.implementation],this.keyRange=r.IDBKeyRange||r.webkitIDBKeyRange||r.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()},u={constructor:i,version:"1.7.1",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var t=this.idb.open(this.dbName,this.dbVersion),n=!1;t.onerror=function(t){if(e(t))this.onError(new Error("The version number provided is lower than the existing one."));else{var n;if(t.target.error)n=t.target.error;else{var r="IndexedDB unknown error occurred when opening DB "+this.dbName+" version "+this.dbVersion;"errorCode"in t.target&&(r+=" with error code "+t.target.errorCode),n=new Error(r)}this.onError(n)}}.bind(this),t.onsuccess=function(t){if(!n){if(this.db)return this.onStoreReady(),void 0;if(this.db=t.target.result,"string"==typeof this.db.version)return this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser.")),void 0;if(!this.db.objectStoreNames.contains(this.storeName))return this.onError(new Error("Object store couldn't be created.")),void 0;var e=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=e.objectStore(this.storeName);var r=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(t){var e=t.name;if(!e)return n=!0,this.onError(new Error("Cannot create index: No index name given.")),void 0;if(this.normalizeIndexData(t),this.hasIndex(e)){var o=this.store.index(e),i=this.indexComplies(o,t);i||(n=!0,this.onError(new Error('Cannot modify index "'+e+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),r.splice(r.indexOf(e),1)}else n=!0,this.onError(new Error('Cannot create new index "'+e+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),r.length&&(n=!0,this.onError(new Error('Cannot delete index(es) "'+r.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),n||this.onStoreReady()}}.bind(this),t.onupgradeneeded=function(t){if(this.db=t.target.result,this.db.objectStoreNames.contains(this.storeName))this.store=t.target.transaction.objectStore(this.storeName);else{var e={autoIncrement:this.autoIncrement};null!==this.keyPath&&(e.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,e)}var r=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(t){var e=t.name;if(e||(n=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(t),this.hasIndex(e)){var o=this.store.index(e),i=this.indexComplies(o,t);i||(this.store.deleteIndex(e),this.store.createIndex(e,t.keyPath,{unique:t.unique,multiEntry:t.multiEntry})),r.splice(r.indexOf(e),1)}else this.store.createIndex(e,t.keyPath,{unique:t.unique,multiEntry:t.multiEntry})},this),r.length&&r.forEach(function(t){this.store.deleteIndex(t)},this)}.bind(this)},deleteDatabase:function(t,e){if(this.idb.deleteDatabase){this.db.close();var n=this.idb.deleteDatabase(this.dbName);n.onsuccess=t,n.onerror=e}else e(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(t,e,o,i){null!==this.keyPath&&(i=o,o=e,e=t),i||(i=n),o||(o=r);var u,c=!1,s=null,a=this.db.transaction([this.storeName],this.consts.READ_WRITE);return a.oncomplete=function(){var t=c?o:i;t(s)},a.onabort=i,a.onerror=i,null!==this.keyPath?(this._addIdPropertyIfNeeded(e),u=a.objectStore(this.storeName).put(e)):u=a.objectStore(this.storeName).put(e,t),u.onsuccess=function(t){c=!0,s=t.target.result},u.onerror=i,a},get:function(t,e,o){o||(o=n),e||(e=r);var i=!1,u=null,c=this.db.transaction([this.storeName],this.consts.READ_ONLY);c.oncomplete=function(){var t=i?e:o;t(u)},c.onabort=o,c.onerror=o;var s=c.objectStore(this.storeName).get(t);return s.onsuccess=function(t){i=!0,u=t.target.result},s.onerror=o,c},remove:function(t,e,o){o||(o=n),e||(e=r);var i=!1,u=null,c=this.db.transaction([this.storeName],this.consts.READ_WRITE);c.oncomplete=function(){var t=i?e:o;t(u)},c.onabort=o,c.onerror=o;var s=c.objectStore(this.storeName)["delete"](t);return s.onsuccess=function(t){i=!0,u=t.target.result},s.onerror=o,c},batch:function(t,e,o){if(o||(o=n),e||(e=r),"[object Array]"!=Object.prototype.toString.call(t))o(new Error("dataArray argument must be of type Array."));else if(0===t.length)return e(!0);var i=t.length,u=!1,c=!1,s=this.db.transaction([this.storeName],this.consts.READ_WRITE);s.oncomplete=function(){var t=c?e:o;t(c)},s.onabort=o,s.onerror=o;var a=function(){i--,0!==i||u||(u=!0,c=!0)};return t.forEach(function(t){var e=t.type,n=t.key,r=t.value,i=function(t){s.abort(),u||(u=!0,o(t,e,n))};if("remove"==e){var c=s.objectStore(this.storeName)["delete"](n);c.onsuccess=a,c.onerror=i}else if("put"==e){var l;null!==this.keyPath?(this._addIdPropertyIfNeeded(r),l=s.objectStore(this.storeName).put(r)):l=s.objectStore(this.storeName).put(r,n),l.onsuccess=a,l.onerror=i}},this),s},putBatch:function(t,e,n){var r=t.map(function(t){return{type:"put",value:t}});return this.batch(r,e,n)},upsertBatch:function(t,e,o,i){"function"==typeof e&&(o=e,i=o,e={}),i||(i=n),o||(o=r),e||(e={}),"[object Array]"!=Object.prototype.toString.call(t)&&i(new Error("dataArray argument must be of type Array."));var u=e.keyField||this.keyPath,c=t.length,s=!1,a=!1,l=0,f=this.db.transaction([this.storeName],this.consts.READ_WRITE);f.oncomplete=function(){a?o(t):i(!1)},f.onabort=i,f.onerror=i;var d=function(e){var n=t[l++];n[u]=e.target.result,c--,0!==c||s||(s=!0,a=!0)};return t.forEach(function(t){var e,n=t.key,r=function(t){f.abort(),s||(s=!0,i(t))};null!==this.keyPath?(this._addIdPropertyIfNeeded(t),e=f.objectStore(this.storeName).put(t)):e=f.objectStore(this.storeName).put(t,n),e.onsuccess=d,e.onerror=r},this),f},removeBatch:function(t,e,n){var r=t.map(function(t){return{type:"remove",key:t}});return this.batch(r,e,n)},getBatch:function(t,e,o,i){if(o||(o=n),e||(e=r),i||(i="sparse"),"[object Array]"!=Object.prototype.toString.call(t))o(new Error("keyArray argument must be of type Array."));else if(0===t.length)return e([]);var u=[],c=t.length,s=!1,a=!1,l=null,f=this.db.transaction([this.storeName],this.consts.READ_ONLY);f.oncomplete=function(){var t=a?e:o;t(l)},f.onabort=o,f.onerror=o;var d=function(t){t.target.result||"dense"==i?u.push(t.target.result):"sparse"==i&&u.length++,c--,0===c&&(s=!0,a=!0,l=u)};return t.forEach(function(t){var e=function(t){s=!0,l=t,o(t),f.abort()},n=f.objectStore(this.storeName).get(t);n.onsuccess=d,n.onerror=e},this),f},getAll:function(t,e){e||(e=n),t||(t=r);var o=this.db.transaction([this.storeName],this.consts.READ_ONLY),i=o.objectStore(this.storeName);return i.getAll?this._getAllNative(o,i,t,e):this._getAllCursor(o,i,t,e),o},_getAllNative:function(t,e,n,r){var o=!1,i=null;t.oncomplete=function(){var t=o?n:r;t(i)},t.onabort=r,t.onerror=r;var u=e.getAll();u.onsuccess=function(t){o=!0,i=t.target.result},u.onerror=r},_getAllCursor:function(t,e,n,r){var o=[],i=!1,u=null;t.oncomplete=function(){var t=i?n:r;t(u)},t.onabort=r,t.onerror=r;var c=e.openCursor();c.onsuccess=function(t){var e=t.target.result;e?(o.push(e.value),e["continue"]()):(i=!0,u=o)},c.onError=r},clear:function(t,e){e||(e=n),t||(t=r);var o=!1,i=null,u=this.db.transaction([this.storeName],this.consts.READ_WRITE);u.oncomplete=function(){var n=o?t:e;n(i)},u.onabort=e,u.onerror=e;var c=u.objectStore(this.storeName).clear();return c.onsuccess=function(t){o=!0,i=t.target.result},c.onerror=e,u},_addIdPropertyIfNeeded:function(t){"undefined"==typeof t[this.keyPath]&&(t[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(t){return this.store.indexNames.contains(t)},normalizeIndexData:function(t){t.keyPath=t.keyPath||t.name,t.unique=!!t.unique,t.multiEntry=!!t.multiEntry},indexComplies:function(t,e){var n=["keyPath","unique","multiEntry"].every(function(n){if("multiEntry"==n&&void 0===t[n]&&e[n]===!1)return!0;if("keyPath"==n&&"[object Array]"==Object.prototype.toString.call(e[n])){var r=e.keyPath,o=t.keyPath;if("string"==typeof o)return r.toString()==o;if("function"!=typeof o.contains&&"function"!=typeof o.indexOf)return!1;if(o.length!==r.length)return!1;for(var i=0,u=r.length;u>i;i++)if(!(o.contains&&o.contains(r[i])||o.indexOf(-1!==r[i])))return!1;return!0}return e[n]==t[n]});return n},iterate:function(e,r){r=t({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:n,limit:1/0,offset:0,allowItemRejection:!1},r||{});var o="desc"==r.order.toLowerCase()?"PREV":"NEXT";r.filterDuplicates&&(o+="_NO_DUPLICATE");var i=!1,u=this.db.transaction([this.storeName],this.consts[r.writeAccess?"READ_WRITE":"READ_ONLY"]),c=u.objectStore(this.storeName);r.index&&(c=c.index(r.index));var s=0;u.oncomplete=function(){return i?(r.onEnd?r.onEnd():e(null),void 0):(r.onError(null),void 0)},u.onabort=r.onError,u.onerror=r.onError;var a=c.openCursor(r.keyRange,this.consts[o]);return a.onerror=r.onError,a.onsuccess=function(t){var n=t.target.result;if(n)if(r.offset)n.advance(r.offset),r.offset=0;else{var o=e(n.value,n,u);r.allowItemRejection&&o===!1||s++,r.autoContinue&&(s+r.offset<r.limit?n["continue"]():i=!0)}else i=!0},u},query:function(t,e){var n=[],r=0;return e=e||{},e.autoContinue=!0,e.writeAccess=!1,e.allowItemRejection=!!e.filter,e.onEnd=function(){t(n,r)},this.iterate(function(t){r++;var o=e.filter?e.filter(t):!0;return o!==!1&&n.push(t),o},e)},count:function(e,r){r=t({index:null,keyRange:null},r||{});var o=r.onError||n,i=!1,u=null,c=this.db.transaction([this.storeName],this.consts.READ_ONLY);c.oncomplete=function(){var t=i?e:o;t(u)},c.onabort=o,c.onerror=o;var s=c.objectStore(this.storeName);r.index&&(s=s.index(r.index));var a=s.count(r.keyRange);return a.onsuccess=function(t){i=!0,u=t.target.result},a.onError=o,c},makeKeyRange:function(t){var e,n="undefined"!=typeof t.lower,r="undefined"!=typeof t.upper,o="undefined"!=typeof t.only;switch(!0){case o:e=this.keyRange.only(t.only);break;case n&&r:e=this.keyRange.bound(t.lower,t.upper,t.excludeLower,t.excludeUpper);break;case n:e=this.keyRange.lowerBound(t.lower,t.excludeLower);break;case r:e=this.keyRange.upperBound(t.upper,t.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return e}},c={};return i.prototype=u,i.version=u.version,i},this)},{}]},{},[]);